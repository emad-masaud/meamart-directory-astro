---
import Listing from "@layouts/Listing.astro";
import { render } from "astro:content";
import Landing from "@layouts/Landing.astro";
import { getRootPages } from "@lib/getRootPages";

export const prerender = false;

// Fetch all listings and pages
const { slug } = Astro.params;
const { entry } = Astro.props;

if (!entry) {
  return Astro.redirect("/404");
}

const { Content } = await render(entry);

export async function getStaticPaths() {
  return await getRootPages();
}

const landingView = !slug || slug === "blog";
---

{
  landingView ? (
    <Landing>
      <Content />
    </Landing>
  ) : (
    <Listing frontmatter={entry.data} slug={slug}>
      <Content />
    </Listing>
  )
}
